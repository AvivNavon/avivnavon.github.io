<!-- Dark mode toggle + logic -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const root = document.documentElement;
  const KEY = 'theme';
  const mq = window.matchMedia('(prefers-color-scheme: dark)');

  // 1. Ensure a theme is set
  const saved = localStorage.getItem(KEY);
  if (saved === 'dark' || saved === 'light') {
    root.setAttribute('data-theme', saved);
  } else {
    root.setAttribute('data-theme', mq.matches ? 'dark' : 'light');
  }

  // 2. Create the toggle button if it doesn't exist
  let btn = document.getElementById('theme-toggle');
  if (!btn) {
    btn = document.createElement('button');
    btn.id = 'theme-toggle';
    btn.className = 'theme-toggle';
    btn.setAttribute('aria-label', 'Toggle dark mode');
    btn.textContent = 'ðŸŒ“';
    btn.style.cssText = `
      position: fixed;
      top: 12px;
      right: 14px;
      z-index: 9999;
      background: transparent;
      border: 0;
      padding: 6px 8px;
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
      border-radius: 8px;
      color: inherit;
    `;
    document.body.appendChild(btn);
  }

  // 3. Toggle theme when clicked
  btn.addEventListener('click', function() {
    const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    root.setAttribute('data-theme', next);
    localStorage.setItem(KEY, next);
  });

  // 4. Follow OS preference if user hasnâ€™t saved choice
  mq.addEventListener('change', e => {
    if (!localStorage.getItem(KEY)) {
      root.setAttribute('data-theme', e.matches ? 'dark' : 'light');
    }
  });
});
</script>

<script>
  // Add a short overlay fade when switching themes
  const root = document.documentElement;
  const fadeMs = 250;
  const addFade = () => {
    root.classList.add("is-transitioning");
    setTimeout(() => root.classList.remove("is-transitioning"), fadeMs);
  };

  const btn = document.getElementById("theme-toggle");
  if (btn) {
    const oldHandler = btn.onclick || null;
    btn.onclick = e => {
      if (typeof oldHandler === "function") oldHandler(e);
      addFade();
    };
  }
</script>

